<script>
    // 1. Initialize
    log("System: Initializing Pi SDK...");
    Pi.init({ version: "2.0" });

    // 2. The Login Function
    async function tryLogin() {
        log("ðŸ‘‰ Button Clicked. Waiting 1 second for SDK safety...");
        
        // Small delay to ensure the bridge between GitHub and Pi Browser is solid
        setTimeout(async () => {
            log("ðŸš€ Calling Pi.authenticate now...");
            
            try {
                const auth = await Pi.authenticate(['username', 'payments'], function(payment) {
                    log("Payment Check: " + payment.identifier);
                    return true;
                });
                
                log("âœ… LOGIN SUCCESS! Welcome " + auth.user.username);
                alert("Authenticated as " + auth.user.username);
                
            } catch (err) {
                // If it fails, it MUST show an error here. 
                // If nothing shows, the Pi Browser is blocking the request entirely.
                log("ðŸ›‘ AUTH FAILED: " + JSON.stringify(err));
                alert("Error: " + err);
            }
        }, 1000);
    }

    document.getElementById('btn-login').onclick = tryLogin;
</script>
