<script>
    // --- ðŸ§  PROJECT BAZAAR LOGIC ENGINE (2026) ---
    let trust = 15;
    let isConnected = false;
    let isStaked = false;

    // 1. Initialize the UI on Load
    window.onload = () => {
        updateUI();
        // Simulation: Hide "Loading" after 1.5 seconds
        setTimeout(() => {
            document.getElementById('admin-display').innerText = "Admin: Verified (PinoyQ8)";
        }, 1500);
    };

    function updateUI() {
        // Update Gauge
        const angle = trust * 3.6;
        document.getElementById('trust-gauge').style.background = `conic-gradient(var(--gold) ${angle}deg, #333 0deg)`;
        document.getElementById('ts-display').innerText = trust + "%";

        // Update Bond Status text
        const bondText = document.getElementById('bond-text');
        const stakeBtn = document.getElementById('stake-btn');
        
        if (isStaked) {
            bondText.innerText = "â— SECURE";
            bondText.style.color = "var(--green)";
            stakeBtn.innerText = "âœ… BOND ACTIVE";
            stakeBtn.style.opacity = "0.5";
            stakeBtn.disabled = true;
        }
    }

    // 2. Connect Wallet Simulation
    function connectWallet() {
        const btn = document.getElementById('connect-btn');
        btn.innerText = "â³ CONNECTING...";
        
        setTimeout(() => {
            isConnected = true;
            btn.innerText = "ðŸŸ¢ G...P8Q8"; // PinoyQ8 simulated address
            btn.style.borderColor = "var(--green)";
            btn.style.color = "var(--green)";
            showModal("WALLET CONNECTED", "Merchant Wallet G...P8Q8 is now linked to Project Bazaar.");
        }, 1200);
    }

    // 3. Stake Bond Simulation
    function stakeBond() {
        if (!isConnected) {
            showModal("CONNECTION REQUIRED", "Please connect your Pi Wallet before staking the Integrity Bond.");
            return;
        }

        showModal("CONFIRM STAKE", "You are about to lock 20 Pi as an Integrity Bond. This will boost your Trust Score by +10%. Proceed?");
        
        // Add a "Proceed" button to the modal for the demo
        const modalBox = document.querySelector('.modal-box');
        const proceedBtn = document.createElement('button');
        proceedBtn.className = 'btn';
        proceedBtn.innerText = "CONFIRM 20 PI";
        proceedBtn.style.marginTop = "10px";
        proceedBtn.onclick = () => {
            isStaked = true;
            trust += 10;
            updateUI();
            closeModal();
            proceedBtn.remove(); // Cleanup
        };
        modalBox.appendChild(proceedBtn);
    }

    function simulateTrade() {
        if (trust < 100) {
            trust += 2;
            updateUI();
            showModal("TRADE SUCCESS", "Transaction verified. Trust score increased by +2%.");
        }
    }

    // --- UI HELPERS ---
    function showModal(title, msg) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-message').innerText = msg;
        document.getElementById('custom-modal-overlay').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('custom-modal-overlay').style.display = 'none';
        // Remove any temporary confirm buttons added during stakeBond
        const confirmBtn = document.querySelector('.modal-box .btn:nth-of-type(2)');
        if (confirmBtn) confirmBtn.remove();
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
    }

    function switchView(view) {
        console.log("Navigating to: " + view);
        // You can add logic here to hide/show different divs later
    }
</script>